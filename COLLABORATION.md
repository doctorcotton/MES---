# 多人协作功能使用说明

## 功能概述

MES配方编辑器现在支持多人协作编辑，包含三种模式：

1. **查看模式** - 默认模式，实时查看他人编辑，但不能修改
2. **编辑模式** - 独占编辑权，可以修改配方数据
3. **演示模式** - 沙盒模式，本地修改不影响服务器数据

## 快速开始

### 1. 启动后端服务器

```bash
cd server
npm install
npm run dev
```

服务器将在 `http://localhost:3001` 启动。

### 2. 启动前端应用

```bash
npm install
npm run dev
```

前端将在 `http://localhost:5173` 启动（或Vite配置的端口）。

### 3. 使用协作功能

1. **申请编辑权**：点击顶部状态栏的"申请编辑"按钮
2. **释放编辑权**：编辑完成后点击"释放编辑权"按钮
3. **演示模式**：点击"演示模式"按钮进入沙盒模式，可以自由操作而不影响服务器数据

## 功能特性

### 编辑锁机制

- 同一时间只有一个人可以编辑
- 编辑权自动释放：
  - 15分钟无操作
  - 30秒无心跳（网络断开）
  - 主动释放

### 实时同步

- 所有用户实时看到编辑者的修改
- 自动保存（3秒防抖）
- 心跳保持连接（10秒间隔）

### 演示模式

- 专为展示设计
- 所有功能正常使用
- 修改仅在本地生效
- 可以导出演示数据
- 退出时自动恢复服务器数据

## 注意事项

1. 确保后端服务器运行在前端可以访问的地址
2. 编辑模式下会自动保存，无需手动保存
3. 演示模式下的修改不会同步到服务器
4. 多人同时打开页面时，只有持有编辑权的用户可以修改
